<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>3d File quote</title>
    <link rel="stylesheet" href="static/style.css"/>

</head>
<body>
<div id="circle-container"></div>

<div class="top-gap"></div>
<main>
    <div class="main-container">


        <div class="upload" id="upload-container">
            <label for="stl-upload" class="upload-btn" id="upload-label">Valitse STL<br> tiedosto</label>
            <input type="file" id="stl-upload" name="stl-upload"/>
        </div>
        <div class="info">

            <div>
                <p>Materiaalin Kilo Hinta</p>
                <input class="box" type="number" id="costPerKG"/>
            </div>
            <div>
                <p>Materiaalin tiheys g/cm³</p>
                <input class="box" type="number" value="1.03" id="cm3density"/>
            </div>
            <div>
                <p>Infill %</p>
                <input min="5" max="100" value="50" class="box" type="number" id="infill"/>
            </div>

            <div>
                <p>Yhden Tunnin hinta</p>
                <input class="box" type="number" value="" id="printPrice"/>
            </div>
            <div>
                <p>Printin tunnin tulostus aika tunteina</p>
                <input class="box" type="number" value="" id="1hPrintTime"/>
            </div>
            <div>
                <p>Printtien kpl</p>
                <input class="box" type="number" value="1" id="printVal"/>
            </div>
            <div>
                <p>Tuotto %:tteina</p>
                <input class="box" type="number" value="50" id="profit"/>
            </div>

            <div class="btn">
                <button onclick="updatePrice()" type="submit">Laske</button>
            </div>
            <h3 id="price">Hinta:</h3>
            <div class="misc">
                <!--                <div id="loading"></div>-->
            </div>
        </div>

    </div>

</main>

<script>
    const uploadInput = document.getElementById("stl-upload");
    const uploadLabel = document.getElementById("upload-label");
    const costPerKG = document.getElementById("costPerKG");
    const cm3density = document.getElementById("cm3density");
    const infill = document.getElementById("infill");
    const printPrice = document.getElementById("printPrice");
    const hPrintTime = document.getElementById("1hPrintTime");
    const printVal = document.getElementById("printVal");

    const profit = document.getElementById("profit");
    const price = document.getElementById("price");

    let currentUploadController = null
    let valFromServer;
    uploadInput.onchange = () => {
        if (uploadInput.files.length === 0) return;
        currentUploadController = new AbortController();
        const formData = new FormData();
        formData.append("3dfiles", uploadInput.files[0]);
        document.getElementById("upload-label").style.display = "none";
        fetch("/https://hintalaskuri-239782198314.europe-north1.run.app", {
            method: "POST",
            body: formData,
        }).then(res =>
            res.json()
        ).then(data => {
            valFromServer = data;
        })
    };

    function updatePrice() {
        var materialCost = costPerKG.value / 1000;
        lastInfill = 0;
        lastPrice = 0;
        var lastInfill = infill.value / 100 + .15
        var lastPrice = ((valFromServer * printVal.value) * materialCost * lastInfill + (hPrintTime.value * printPrice.value)) * (1 + profit.value / 100);
        price.innerText = "Hinta: "+ Math.floor(lastPrice * 100) /100 + "€";
    }


</script>
</body>
</html>



